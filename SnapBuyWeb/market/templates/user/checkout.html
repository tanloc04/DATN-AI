{% extends 'base_user.html' %}
{% block title %}Thanh toán{% endblock %}

{% block content %}
<style>
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .checkout-section {
    animation: slideIn 0.6s ease;
  }

  .form-label {
    font-weight: 600;
  }

  .form-control {
    border-radius: 8px;
  }

  .card-title {
    font-size: 1.25rem;
    font-weight: 600;
  }

  .total-price {
    font-size: 1.2rem;
    font-weight: bold;
  }

  .cart-item {
    padding: 8px 0;
    border-bottom: 1px dashed #ccc;
  }

  .checkout-icon {
    color: #0d6efd;
    margin-right: 6px;
  }
</style>

<div class="container mt-5 checkout-section">
  <h2 class="text-primary fw-bold mb-4 text-center">
    <i class="bi bi-credit-card-2-back-fill me-2"></i>Thanh toán đơn hàng
  </h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="row g-4">
    <!-- Cart Summary -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h5 class="card-title mb-3"><i class="bi bi-cart4 me-2"></i>Giỏ hàng của bạn</h5>
          {% if cart_items %}
            {% for item in cart_items %}
              <div class="d-flex justify-content-between align-items-center cart-item">
                <span>{{ item.name }} <span class="text-muted">(x{{ cart[item.id|string] if cart[item.id|string] is defined else 0 }})</span></span>
                <strong>{{ (item.price * (cart[item.id|string] if cart[item.id|string] is defined else 0)) | round(2) }}đ</strong>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted">Không có sản phẩm trong giỏ hàng.</p>
          {% endif %}
          <hr>
          <div class="d-flex justify-content-between">
            <span class="total-price text-primary">Tổng cộng:</span>
            <span class="total-price text-primary">{{ total_price | round(2) }}đ</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Checkout Form -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h5 class="card-title mb-3"><i class="bi bi-pencil-square me-2"></i>Thông tin người nhận</h5>
          <form method="POST">
            {{ form.hidden_tag() }}
            <div class="mb-3">
              <label class="form-label"><i class="bi bi-person-circle checkout-icon"></i>Họ và tên</label>
              {{ form.full_name(class="form-control border-primary") }}
              {% for error in form.full_name.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="bi bi-geo-alt checkout-icon"></i>Địa chỉ</label>
              {{ form.address(class="form-control border-primary") }}
              {% for error in form.address.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="bi bi-telephone checkout-icon"></i>Số điện thoại</label>
              {{ form.phone(class="form-control border-primary") }}
              {% for error in form.phone.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>
            {{ form.submit(class="btn btn-primary btn-lg w-100 mt-3") }}
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
